<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Authentication Agent</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.74.0">
<link rel="home" href="index.html" title="PolicyKit-mate Library Reference Manual">
<link rel="up" href="index.html" title="PolicyKit-mate Library Reference Manual">
<link rel="prev" href="polkit-mate-polkit-mate-auth.html" title="Authentication Dialogs">
<link rel="next" href="license.html" title="Appendix A. License">
<meta name="generator" content="GTK-Doc V1.10 (XML mode)">
<link rel="stylesheet" href="style.css" type="text/css">
<link rel="reference" href="ref-core.html" title="API Reference">
<link rel="reference" href="ref-auth-daemon.html" title="Authentication Agent">
<link rel="appendix" href="license.html" title="Appendix A. License">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table class="navigation" id="top" width="100%" summary="Navigation header" cellpadding="2" cellspacing="2"><tr valign="middle">
<td><a accesskey="p" href="polkit-mate-polkit-mate-auth.html"><img src="left.png" width="24" height="24" border="0" alt="Prev"></a></td>
<td> </td>
<td><a accesskey="h" href="index.html"><img src="home.png" width="24" height="24" border="0" alt="Home"></a></td>
<th width="100%" align="center">PolicyKit-mate Library Reference Manual</th>
<td><a accesskey="n" href="license.html"><img src="right.png" width="24" height="24" border="0" alt="Next"></a></td>
</tr></table>
<div class="reference" lang="en">
<div class="titlepage">
<div><div><h1 class="title">
<a name="ref-auth-daemon"></a>Authentication Agent</h1></div></div>
<hr>
</div>
<div class="partintro" lang="en">
<div></div>
<p>
	This part discusses the MATE/GTK+ specific Authentication
	Agent.
      </p>
</div>
<div class="refsect1" lang="en">
<a name="ref-auth-daemon-overview"></a><h2>Overview</h2>
<p>
        The PolicyKit model provides letting an user authenticate in
        order to gain the privilege to let a Mechanism carry work out
        related to a specific Action on the users behalf. In the
        PolicyKit libraries, this functionality is programmatically
        exposed in the PolKitGrant class. As it's tedious to use this
        low-level functionality from a GTK+ or MATE application, the
        high-level functionality is wrapped in a D-Bus service
        available on the session message bus. The way it works is that
        when an application needs privileges, it can call into this
        D-Bus service and an authentication dialog will appear. When
        the user is done with the authentication dialog, the
        application recieves a reply from the D-Bus containing a
        boolean indicating whether the user gained the privilege or
        not.
      </p>
</div>
<div class="refsect1" lang="en">
<a name="ref-auth-daemon-overview-dbus"></a><h2>D-Bus interface</h2>
<p>
        The D-Bus service is available on the session message bus with
        the
        name <code class="literal">org.freedesktop.PolicyKit.AuthenticationAgent</code>
        and exports a single object <code class="literal">/</code> that
        implements the
        interface <code class="literal">org.freedesktop.PolicyKit.AuthenticationAgent</code>. The
        D-Bus introspection XML looks like this
      </p>
<pre class="programlisting">&lt;!DOCTYPE node PUBLIC "-//freedesktop//DTD D-BUS Object Introspection 1.0//EN"
         "http://www.freedesktop.org/standards/dbus/1.0/introspect.dtd"&gt;

&lt;node name="/"&gt;

  &lt;!-- this interface is deprecated and will be removed in a future release --&gt;
  &lt;interface name="org.mate.PolicyKit.Manager"&gt;
    &lt;method name="ShowDialog"&gt;
      &lt;annotation name="org.freedesktop.DBus.GLib.Async" value=""/&gt;

      &lt;!-- IN: PolicyKit action identifier; see PolKitAction --&gt;
      &lt;arg name="action_id" direction="in" type="s"/&gt;

      &lt;!-- IN: X11 window ID for the top-level X11 window the dialog will be transient for. --&gt;
      &lt;arg name="xid" direction="in" type="u"/&gt;

      &lt;!-- OUT: whether the user gained the authorization --&gt;
      &lt;arg name="gained_authorization" direction="out" type="b"/&gt;

    &lt;/method&gt;
  &lt;/interface&gt;

  &lt;interface name="org.freedesktop.PolicyKit.AuthenticationAgent"&gt;
    &lt;method name="ObtainAuthorization"&gt;
      &lt;annotation name="org.freedesktop.DBus.GLib.Async" value=""/&gt;

      &lt;!-- IN: PolicyKit action identifier; see PolKitAction --&gt;
      &lt;arg name="action_id" direction="in" type="s"/&gt;

      &lt;!-- IN: X11 window ID for the top-level X11 window the dialog will be transient for. --&gt;
      &lt;arg name="xid" direction="in" type="u"/&gt;

      &lt;!-- IN: Process ID to grant authorization to --&gt;
      &lt;arg name="pid" direction="in" type="u"/&gt;

      &lt;!-- OUT: whether the user gained the authorization --&gt;
      &lt;arg name="gained_authorization" direction="out" type="b"/&gt;

    &lt;/method&gt;
  &lt;/interface&gt;

&lt;/node&gt;
</pre>
<p>
        The <code class="literal">ObtainAuthorization()</code> method may throw
        an exception if another client is currently using the service
        to show an authentication dialog. In practice this should
        never happen because the authentication daemon grabs the X11
        keyboard and pointer thus preventing the user from activating
        widgets in other applications that would lead to calling into
        the <code class="literal">ObtainAuthorization</code> method.
      </p>
</div>
<div class="refsect1" lang="en">
<a name="ref-auth-daemon-operation"></a><h2>Operation</h2>
<p>
        The authentication daemon uses
        <code class="literal">libpolkit-grant</code> which in turn uses PAM for
        authentication services (however, other authentication
        back-ends can be plugged in as required). As such, a wide
        range of authentication mechanisms are available.
      </p>
<p>
        The authentication daemon is using D-Bus activation and exits
        after 30 seconds of inactivity. Thus the code implementing
        this dialog only runs when necessary.
      </p>
</div>
<div class="refsect1" lang="en">
<a name="ref-auth-daemon-ui-elements"></a><h2>UI elements</h2>
<p>
        The appearance of the authentication dialog depends on the
        result from PolicyKit and also whether administrator
        authentication is defined as "authenticate as the root user"
        or "authenticate as one of the users from UNIX group wheel" or
        however the PolicyKit library is configured (see
        the <code class="literal">PolicyKit.conf(5)</code> manual page for
        details). Note that some of the screenshots below were made on
        a system set up to use
        the <a class="ulink" href="http://thinkfinger.sourceforge.net/" target="_top"><em class="citetitle">ThinkFinger</em></a>
        PAM module.
      </p>
<p>
        The text shown in the authentication dialogs stems from the
        PolicyKit <code class="literal">.policy</code> XML files residing
        in <code class="literal">/usr/share/PolicyKit/policy</code> and is read
        by the authentication daemon when an applications uses
        the <code class="literal">ShowDialog()</code> method. Thus, what the
        user sees is not under application control (e.g. it's not
        passed from the application) which rules out a class of
        attacks where applications are trying to fool the user into
        gaining a privilege.
      </p>
<p>
        Authentication dialog where the user is asked to authenticate
        as herself:
      </p>
<p>
        <img src="auth-self.png">
      </p>
<p>
        Authentication dialog where the user is asked to authenticate
        as an administrative user and PolicyKit is configured to use
        the root password for this:
      </p>
<p>
        <img src="auth-root.png">
      </p>
<p>
        Authentication dialog where the user is asked to authenticate
        as an administrative user and PolicyKit is configured to use
        the UNIX wheel group for this:
      </p>
<p>
        <img src="auth-wheel-group-1.png">
      </p>
<p>
        Same authentication dialog, showing drop down box where the
        user can be selected:
      </p>
<p>
        <img src="auth-wheel-group-2.png">
      </p>
<p>
        Authentication dialog showing an Action where the privilege
        can be retained indefinitely:
      </p>
<p>
        <img src="auth-retain-always.png">
      </p>
<p>
        Authentication dialog showing an Action where the privilege
        can be retained only for the remainer of the desktop session:
      </p>
<p>
        <img src="auth-retain-session.png">
      </p>
<p>
        The details view detailing what Action is being asked for as
        well as what application is requesting the authentication:
      </p>
<p>
        <img src="auth-details.png">
      </p>
</div>
</div>
<div class="footer">
<hr>
          Generated by GTK-Doc V1.10</div>
</body>
</html>
